---
title: "Unit Test v2"
format: html
editor_options: 
  chunk_output_type: console
---

## Load library + functions

```{r}
source("./src/functions.R")

gc()
library(tidyverse)
```

## Import Dataset

```{r}
exDF <- read_csv("./Sandbox/inputCSV.csv")
exDF[2,2] <- "b66"
subjects <- as.vector(t(exDF))
```

## Find Duplicates

The following code chunks are examples of duplicate sample detection.

```{r}
#function to simplify typing same thing each time
ld <- function(){
  return(listDupes(exDF))
}

#exDF contains 1 duplicate
ld()

#multi duplicate
exDF[4,] <- "d72"
exDF[1,3] <- "b61"
ld()
```

```{r}
#reset duplicate
exDF <- read_csv("./Sandbox/inputCSV.csv")
exDF[2,2] <- "b66"
# listDupes(exDF)

View(exDF)

#0=no duplicates found
if(listDupes(exDF)==0){
  print("No duplicates found.")
}else{
  print("There are duplicated sample names.")
}
```

## Uneven samples in groups

The `actualNumSamples` function removes any NA values (unequal number of subjects per group) and outputs the true subject list.

User can then use `length()` to give an integer count.

```{r}
#add NA values
subjects_raw <- subjects %>%
  append(c(NA,"o42",NA,NA,"g60","t90"),2)

subjects_raw

#drop NA values
subjects_t <- actualNumSamples(subjects_raw)

#num actual subjects/samples
length(subjects_t)
```

## Minimum gels req (WIP)

Use the `minGels` function to determine minimum number of gels required to fit all samples + ladder per gel.

```{r}
minGels(
  numLanes = 6,
  numGroups = 4,
  perGroup = 4
)
```

## Create gels

The following 2 functions create a non-centered gel according to the following rules:

1. all members of a group must be represented â‰¥ 1
1. 2 samples from same group can't be next to each other

```{r}
gels <- gelBaseline(
  totalSamples = 16,
  perLine = 8,
  entryID = subjects
)

gels <- addCols(
  inputDF = gels,
  numLanes = 11
)

# View(gels)
```

## Center Samples on Gel

The `centerSamples` function takes a non-centered gel and attempts to center the samples (ladder is not centered and is left at first lane).

```{r}
centeredGel <- centerSamples(gels)
# View(centeredGel)
```

Each row is considered a separate gel.

## Export user template

Create user template with everything except for quant filled in.

```{r}
user_template <- finalizedDF(
  inputGel = centeredGel,
  sourceDF = exDF,
  numReps = 3
)

View(user_template)
```

## rm

```{r}
rm(ld)
```
